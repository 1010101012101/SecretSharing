copyright from https://github.com/Archistar/archistar-smc